<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orçamento - AtomoTech</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        /* Esconder campos de entrada e botões no PDF */
        .hide-on-pdf {
            display: none !important;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">

    <div id="orcamento-container" class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg p-8">
        <div class="relative flex justify-between items-center mb-6">
            <button id="voltar-btn" class="absolute left-0 top-1/2 transform -translate-y-1/2 px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors">Voltar</button>
            <div class="flex-grow text-center">
                <h1 class="text-3xl font-bold text-gray-800 inline-block">Orçamento</h1>
            </div>
            <img src="https://placehold.co/150x50/e2e8f0/334155?text=AtomoTech" alt="Logo da AtomoTech" class="w-28 rounded-md ml-auto">
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 text-sm">
            <div>
                <p class="font-bold text-gray-700">Orçamento:</p>
                <p id="orcamento-numero" class="text-gray-900 font-mono"></p>
            </div>
            <div>
                <p class="font-bold text-gray-700">Data:</p>
                <p id="data-atual" class="text-gray-900"></p>
            </div>
            <div>
                <p class="font-bold text-gray-700">Validade:</p>
                <input type="text" value="30 dias" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <p class="font-bold text-gray-700">Condições de Pagamento:</p>
                <input type="text" value="Avista" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
        </div>

        <div class="mb-8 p-6 bg-gray-50 rounded-lg">
            <h2 class="text-lg font-semibold text-gray-700 mb-4">Informações do Cliente</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <input id="cliente-nome" type="text" placeholder="Nome" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <input id="cliente-email" type="email" placeholder="Email" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <input id="cliente-telefone" type="tel" placeholder="Telefone" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
        </div>

        <div class="overflow-x-auto mb-4">
            <table class="w-full text-sm text-left text-gray-500">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3">Descrição</th>
                        <th scope="col" class="px-6 py-3">Qtd</th>
                        <th scope="col" class="px-6 py-3">Valor Unit.</th>
                        <th scope="col" class="px-6 py-3">Total</th>
                        <th scope="col" class="px-6 py-3 hide-on-pdf"></th>
                    </tr>
                </thead>
                <tbody id="itens-tabela">
                    <!-- Itens serão adicionados aqui -->
                </tbody>
                <tfoot>
                    <tr class="font-semibold text-gray-900">
                        <td colspan="3" class="px-6 py-3 text-right">Total:</td>
                        <td id="total-orcamento" class="px-6 py-3 text-right">R$ 0,00</td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <button id="add-item-btn" class="mb-8 px-6 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors">Adicionar Item</button>
        
        <div class="flex justify-end gap-4 mb-8">
            <button id="salvar-btn" class="px-6 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition-colors">Salvar</button>
            <button id="gerar-pdf-btn" class="px-6 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors">Gerar PDF</button>
        </div>

        <div class="border-t pt-6 text-sm text-center text-gray-600">
            <p>Assinatura do Cliente</p>
        </div>
    </div>

    <!-- Script para gerar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const itensTabela = document.getElementById('itens-tabela');
            const addItemBtn = document.getElementById('add-item-btn');
            const totalOrcamentoSpan = document.getElementById('total-orcamento');
            const dataAtualSpan = document.getElementById('data-atual');
            const orcamentoNumeroSpan = document.getElementById('orcamento-numero');
            const gerarPdfBtn = document.getElementById('gerar-pdf-btn');
            const salvarBtn = document.getElementById('salvar-btn');
            const voltarBtn = document.getElementById('voltar-btn');
            
            // Setar data e número do orçamento
            const data = new Date();
            const dia = String(data.getDate()).padStart(2, '0');
            const mes = String(data.getMonth() + 1).padStart(2, '0');
            const ano = data.getFullYear().toString().substring(2);
            dataAtualSpan.textContent = `${dia}/${mes}/${data.getFullYear()}`;
            
            const numeroAleatorio = Math.floor(100 + Math.random() * 900);
            orcamentoNumeroSpan.textContent = `${dia}${mes}${ano}-${numeroAleatorio}`;
            
            let total = 0;

            const updateSubtotal = (row) => {
                const qtdInput = row.querySelector('.qtd');
                const valorUnitInput = row.querySelector('.valor-unit');
                const totalSpan = row.querySelector('.item-total');

                const qtd = parseFloat(qtdInput.value) || 0;
                const valorUnit = parseFloat(valorUnitInput.value) || 0;
                const subtotal = qtd * valorUnit;

                totalSpan.textContent = subtotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                return subtotal;
            };

            const updateTotal = () => {
                total = 0;
                document.querySelectorAll('#itens-tabela tr').forEach(row => {
                    const subtotalText = row.querySelector('.item-total').textContent.replace('R$', '').replace('.', '').replace(',', '.').trim();
                    total += parseFloat(subtotalText);
                });
                totalOrcamentoSpan.textContent = total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            };

            const addItem = (descricao = '', qtd = '', valorUnit = '') => {
                const newRow = document.createElement('tr');
                newRow.classList.add('bg-white', 'border-b', 'hover:bg-gray-50');
                newRow.innerHTML = `
                    <td class="px-6 py-4"><input type="text" value="${descricao}" class="descricao w-full px-2 py-1 border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500"></td>
                    <td class="px-6 py-4"><input type="number" value="${qtd}" class="qtd w-20 px-2 py-1 border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 text-right"></td>
                    <td class="px-6 py-4"><input type="number" value="${valorUnit}" step="0.01" class="valor-unit w-24 px-2 py-1 border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 text-right"></td>
                    <td class="px-6 py-4 text-right item-total">R$ 0,00</td>
                    <td class="px-6 py-4 text-right hide-on-pdf">
                        <button class="remover-item-btn text-red-600 hover:text-red-800 transition-colors">Remover</button>
                    </td>
                `;
                itensTabela.appendChild(newRow);

                const qtdInput = newRow.querySelector('.qtd');
                const valorUnitInput = newRow.querySelector('.valor-unit');
                const removerBtn = newRow.querySelector('.remover-item-btn');

                const updateRowTotal = () => {
                    updateSubtotal(newRow);
                    updateTotal();
                };

                qtdInput.addEventListener('input', updateRowTotal);
                valorUnitInput.addEventListener('input', updateRowTotal);
                
                removerBtn.addEventListener('click', () => {
                    newRow.remove();
                    updateTotal();
                });

                updateSubtotal(newRow);
                updateTotal();
            };

            addItemBtn.addEventListener('click', () => addItem());

            // Exemplo de itens iniciais
            addItem('RJ45', 10, 3.00);
            addItem('Cabo', 4, 350.00);

            // Gerar PDF de forma profissional
            gerarPdfBtn.addEventListener('click', () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                let y = 20;

                // Título e dados da empresa
                doc.setFontSize(24);
                doc.text("Orçamento de Serviço", 105, y, null, null, "center");
                y += 10;
                doc.setFontSize(14);
                doc.text("AtomoTech", 105, y, null, null, "center");
                y += 10;
                doc.line(20, y, 190, y); // Linha separadora
                y += 10;

                // Dados do orçamento
                doc.setFontSize(12);
                doc.text(`Orçamento: ${orcamentoNumeroSpan.textContent}`, 20, y);
                doc.text(`Data: ${dataAtualSpan.textContent}`, 105, y);
                y += 7;
                doc.text(`Validade: ${document.querySelector('input[value="30 dias"]').value}`, 20, y);
                doc.text(`Condições de Pagamento: ${document.querySelector('input[value="Avista"]').value}`, 105, y);
                y += 10;

                // Informações do Cliente
                doc.setFontSize(14);
                doc.text("Informações do Cliente", 20, y);
                y += 7;
                doc.setFontSize(12);
                doc.text(`Nome: ${document.getElementById('cliente-nome').value}`, 20, y);
                doc.text(`Email: ${document.getElementById('cliente-email').value}`, 105, y);
                y += 7;
                doc.text(`Telefone: ${document.getElementById('cliente-telefone').value}`, 20, y);
                y += 10;

                // Tabela de itens
                const headers = ["Descrição", "Qtd", "Valor Unit.", "Total"];
                const dataRows = [];
                document.querySelectorAll('#itens-tabela tr').forEach(row => {
                    const rowData = [
                        row.querySelector('.descricao').value,
                        row.querySelector('.qtd').value,
                        row.querySelector('.valor-unit').value,
                        row.querySelector('.item-total').textContent
                    ];
                    dataRows.push(rowData);
                });
                
                doc.autoTable({
                    head: [headers],
                    body: dataRows,
                    startY: y,
                    theme: 'grid',
                    styles: { cellPadding: 2, fontSize: 10 },
                    columnStyles: {
                        0: { cellWidth: 'auto' },
                        1: { cellWidth: 20 },
                        2: { cellWidth: 30 },
                        3: { cellWidth: 30 }
                    }
                });

                // Total
                y = doc.autoTable.previous.finalY + 5;
                doc.setFontSize(12);
                doc.text(`Total: ${totalOrcamentoSpan.textContent}`, 180, y, null, null, "right");
                y += 20;

                // Assinatura
                doc.line(60, y, 150, y);
                y += 5;
                doc.text("Assinatura do Cliente", 105, y, null, null, "center");

                // Salvar o PDF
                const orcamentoNumero = orcamentoNumeroSpan.textContent.replace(/ /g, '_').replace('#', '');
                doc.save(`orcamento-${orcamentoNumero}.pdf`);
            });

            // Botão Salvar
            salvarBtn.addEventListener('click', () => {
                alert('Funcionalidade de salvar ainda não implementada.');
                // Adicione a lógica para salvar os dados do orçamento aqui (ex: enviar para um servidor)
            });

            // Botão Voltar
            voltarBtn.addEventListener('click', () => {
                window.history.back();
            });
        });
    </script>
    <!-- Adiciona a biblioteca jsPDF-AutoTable para criar tabelas no PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.14/jspdf.plugin.autotable.min.js"></script>
</body>
</html>
